$(function(){fnTab('.tab-tit a','.tab-con > div');$('.tab-tit a').on('click',function(){sendBagInit();if($(this).hasClass('tit-fight-luck')){$('.f-item-ordinary-number').hide().prev().show();$('.f-item-fight-luck').show().next().hide()}if($(this).hasClass('tit-ordinary')){$('.f-item-ordinary-number').show().prev().hide();$('.f-item-ordinary').show().prev().hide()}});var itemInput=$('.f-item input[type="text"]');itemInput.each(function(){var _this=$(this);_this.on('blur',function(){var number=$('#number'),number1=$('#numberOrdinary'),vouchersSum=$('#vouchersSum'),vouchersEach=$('#vouchersEach'),numVal=number.val(),num1Val=number1.val(),vouchersSumVal=vouchersSum.val(),vouchersEachVal=vouchersEach.val();if($('.tit-fight-luck').hasClass('active')){if(numVal!=''&&vouchersSumVal!=''){if(parseInt(vouchersSumVal)<parseInt(numVal)){layer.msg('夺宝券张数必须大于发放人数')}else{var stampsUse=parseInt(vouchersSumVal)>=parseInt(luckyBag.remainVoucherNum)?luckyBag.remainVoucherNum:vouchersSumVal;fnNeedPay(vouchersSumVal,stampsUse)}}}if($('.tit-ordinary').hasClass('active')){if(num1Val!=''&&vouchersEachVal!=''){var stampsUse=parseInt(luckyBag.remainVoucherNum);var needStamps=parseInt(vouchersEachVal*num1Val);fnNeedPay(needStamps,stampsUse)}}})})$('#btnConfirm').on('click',function(){var numVal=$('#number').val(),num1Val=$('#numberOrdinary').val(),vouchersSumVal=$('#vouchersSum').val(),vouchersEachVal=$('#vouchersEach').val(),cost=$('#needPay').text();var flag=validate();if(flag){if($('.tit-fight-luck').hasClass('active')){$('.mask, #popupInstalled').show();$('#btnPopupClose1').on('click',function(){$('#popupInstalled').hide();$('#popupToCenter').show()})}if($('.tit-ordinary').hasClass('active')){$('.mask, #popupInstalled').show();$('#btnPopupClose1').on('click',function(){$('#popupInstalled').hide();$('#popupToCenter').show()})}}return false});$('#btnPopSend').on('click',function(){$('.popup-send-bag').hide();$('.popup-share').show()});$('#sendContinue').on('click',function(){$('.popup-send-bag').hide();$('.popup-share').show()});$('.mask, .popup-share').on('click',function(){$('.mask, .popup').hide()});$('#btnPopupClose').on('click',function(){$('.mask, .popup').hide()})});var sendBagInit=function(remainStamps){var num=$('#number'),num1=$('#numberOrdinary'),vouchersSum=$('#vouchersSum'),vouchersEach=$('#vouchersEach');if($('.tit-fight-luck').hasClass('active')){var numVal=isEmpty(num)?'':num.val();var vouchersSumVal=isEmpty(vouchersSum)?'':vouchersSum.val();var needPay=$('.wishes-fight-luck').children().find('span').text()==0?0:$('.wishes-fight-luck').children().find('span').text();num.val(numVal);vouchersSum.val(vouchersSumVal);$('#needPay').text('￥'+needPay)}if($('.tit-ordinary').hasClass('active')){var num1Val=isEmpty(num1)?'':num1.val();var vouchersEachVal=isEmpty(vouchersEach)?'':vouchersEach.val();var needPay=$('.wishes-ordinary').children().find('span').text()==0?0:$('.wishes-ordinary').children().find('span').text();num1.val(num1Val);vouchersEach.val(vouchersEachVal);$('#needPay').text('￥'+needPay)}}var validate=function(){var isChecked=false;var itemInputs=$('.f-item input[type="text"]');var num=itemInputs.eq(0);var num1=itemInputs.eq(1);var vouchersSum=itemInputs.eq(2);var vouchersEach=itemInputs.eq(3);var reg=/^\+?[1-9]\d*$/;if($('.tit-fight-luck').hasClass('active')){if(isEmpty(num)){layer.msg('请输入'+num.prev('label').text())}else if(!reg.test(trim(num.val()))){layer.msg('格式错误')}else if(isEmpty(vouchersSum)){layer.msg('请输入'+vouchersSum.prev('label').text())}else if(!reg.test(trim(vouchersSum.val()))){layer.msg('格式错误')}else if(parseInt(vouchersSum.val())<parseInt(num.val())){layer.msg('夺宝券张数必须大于发放人数')}else{isChecked=true}}if($('.tit-ordinary').hasClass('active')){if(isEmpty(num1)){layer.msg('请输入'+num1.prev('label').text())}else if(!reg.test(trim(num1.val()))){layer.msg('格式错误')}else if(isEmpty(vouchersEach)){layer.msg('请输入'+vouchersEach.prev('label').text())}else if(!reg.test(trim(vouchersEach.val()))){layer.msg('格式错误')}else{isChecked=true}}return isChecked}var fnNeedPay=function(vouchersSum,remainVoucherNum){var needPay=(vouchersSum-remainVoucherNum)*1;if(needPay<0){needPay=0;if($('.tit-ordinary').hasClass('active')){remainVoucherNum=vouchersSum}}var payTips=$('<p class="pay-tips">使用夺宝券<em>'+remainVoucherNum+'</em>张，还需支付￥<span>'+needPay+'</span></p>');$('.wishes').find('.pay-tips').remove();if($('.tit-fight-luck').hasClass('active')){$('.wishes-fight-luck').append(payTips)}if($('.tit-ordinary').hasClass('active')){$('.wishes-ordinary').append(payTips)}$('#needPay').text('￥'+needPay)}